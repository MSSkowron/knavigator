apiVersion: batch.volcano.sh/v1alpha1
kind: Job
metadata:
  name: "{{._NAME_}}"
  namespace: {{.namespace}}
spec:
  minAvailable: {{.replicas}}
  schedulerName: volcano
  policies:
  - event: PodEvicted
    action: RestartJob
  plugins:
    ssh: []
    env: []
    svc: []
  maxRetry: 5
  queue: {{.queue}}
  tasks:
  - replicas: {{.replicas}}
    name: test
    template:
      metadata:
        name: test
        labels:
          app: {{._NAME_}}
        annotations:
          pod-complete.stage.kwok.x-k8s.io/delay: {{.ttl}}
          pod-complete.stage.kwok.x-k8s.io/jitter-delay: {{.ttl}}
      spec:
        containers:
        - name: job
          image: {{.image}}
          imagePullPolicy: IfNotPresent
          resources:
            limits:
              cpu: {{.cpu}}
              memory: {{.memory}}
              nvidia.com/gpu: {{.gpu}}
            requests:
              cpu: {{.cpu}}
              memory: {{.memory}}
              nvidia.com/gpu: {{.gpu}}
